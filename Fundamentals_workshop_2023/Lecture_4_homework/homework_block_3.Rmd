---
title: "Visualizing Data"
subtitle: "Fundamentals of R Workshop - Homework 3"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documents/GitHub/Fundamentals_of_R_IHEID2022/Fundamentals_workshop_2023/Lecture_4_homework")
phd_theses <- readRDS("phd_theses.Rds")
library(ggplot2)
library(dplyr)
```

-   All materials for the exercises below are available in the homework folder on Moodle.
-   Please submit your answers as a HTML or a PDF file generated with Rmarkdown.
-   Please make sure to include code chunks and plots in submitted the document.
- Please add titles, legends, and themes to your plots for clarity.

# Ph.D. theses at the Graduate Institute III

The Institute has been the home for hundreds of PhD students over time. In this homework, we will visualize data to investigate how PhD theses at the Institute relate to gender and sustainability topics. The dataset contains the following variables:

| Name                | Description                                          |
|:-----------------------|:----------------------------------------------|
| `thesis_title`      | Title of the Ph.D. thesis.                           |
| `thesis_ID`         | ID of the Ph.D. thesis.                              |
| `thesis_year`       | The year in which a thesis was submitted.            |
| `thesis_author`     | The author of the thesis.                            |
| `thesis_department` | Department in which the thesis was written.          |
| `thesis_language`   | Language in which the thesis was written.            |
| `sus_degree`        | Extent to which theses covers sustainability topics. |
| `gen_degree`        | Extent to which theses covers gender-related topics. |

**Attention this is not the same dataset as previous weeks, please download the data from the correct Moodle folder**

## Question 1

a) Plot a histogram showing the distribution of PHD thesis over time (Tip: you could use base R here, see `?hist`). Why do you think we have so few thesis defenses in 2020?

```{r, include=FALSE}
hist(phd_theses$thesis_year)
```

b) Plot various histograms, side-by-side, showing the distribution of PHD theses over time by department (Tip: use `geom_histogram()` and facet the histograms by 'thesis_department').

```{r, include=FALSE}
ggplot(phd_theses) +
  geom_histogram(aes(thesis_year)) +
  facet_wrap('thesis_department')
```

## Question 2

a) Do we have any NA values in the data? Please replace any NA values in the 'sus_degree' and 'gen_degree' variables with the value of 0 (Tip: you can use `mutate()` and `ifelse()`).

```{r, include=FALSE}
phd_theses <- mutate(phd_theses,
                     sus_degree = ifelse(is.na(sus_degree), 0, sus_degree),
                     gen_degree = ifelse(is.na(gen_degree), 0, gen_degree))
```

b) Please plot the extend to which theses covers sustainability ('sus_degree') and gender ('gen_degree') topics changed over time (Tip: smooth your lines to facilitate visualization, see `?geom_smooth`). Do the frequencies in which these topics appear in PhD theses increase over time?

```{r, include=FALSE}
ggplot(phd_theses) +
  geom_smooth(aes(x = thesis_year, y = sus_degree), color = "green") +
  geom_smooth(aes(x = thesis_year, y = gen_degree), color = "blue")
```

c) Has the extent to which PhD theses cover sustainability ('sus_degree') and gender ('gen_degree') topics increased over time across all departments? Please plot the extend to which theses covers sustainability ('sus_degree') and gender ('gen_degree') topics changed over time by departments (Tip: remember `facet_wrap()`).

```{r, include=FALSE}
phd_theses %>%
  ggplot() +
  geom_smooth(aes(x = thesis_year, y = sus_degree),
              color = "red", se = FALSE) +
  geom_smooth(aes(x = thesis_year, y = gen_degree),
              color = "green", se = FALSE) +
  facet_wrap('thesis_department', scales = "free")
```

## Question 3

a) Create a bar plot displaying the total number of theses written in each department. Please color the bars by the average sustainability score ('sus_degree') (Tip: you can use `group_by()` and `summarise()` to wrangle the data before plotting). Is this a good visualization?

```{r, include=FALSE}
phd_theses %>%
  group_by(thesis_department) %>%
  summarise(count = n(),
            mean_sustainability = mean(sus_degree)) %>% 
  ggplot(aes(x = thesis_department,
             y = count, fill = mean_sustainability)) +
  geom_col()
```

b) Using the same bar plot as above (2a), please color the columns by the average gender score ('gen_degree') and reorder the columns in plot according to their total number (Tip: you can use `reorder()` for your x variable when plotting). How else could you improve this visualization?

```{r, include=FALSE}
phd_theses %>%
  group_by(thesis_department) %>%
  summarise(count = n(),
            mean_gender = mean(gen_degree)) %>% 
  ggplot(aes(x = reorder(thesis_department, count),
             y = count, fill = mean_gender)) +
  geom_col()
```

## Question 4

Plot all theses written before the year 2000, and after the year 2000, comparing the language they were written (Tip: use mutate to create separate categories for before and after 2000). Please interpret the plot.

```{r, include=FALSE}
phd_theses %>%
  mutate(thesis_date = ifelse(thesis_year < 2000,
                              "before_2000", "after_2000")) %>%
  group_by(thesis_date, thesis_language) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = thesis_date, y = count, fill = thesis_language)) +
  geom_col(position = "dodge")

phd_theses %>%
  mutate(thesis_date = factor(ifelse(thesis_year < 2000,
                              "before_2000", "after_2000"),
                              levels = c("before_2000", "after_2000"))) %>%
  group_by(thesis_date, thesis_language, thesis_department) %>%
  summarise(count = n()) %>%
  ggplot() +
  geom_boxplot(aes(x = thesis_date, y = count, fill = thesis_language)) +
  geom_text(aes(x = thesis_date, y = count,
                label= ifelse(thesis_date == "after_2000" &
                  thesis_department == "IRPS" & thesis_language == "en",
                paste0(thesis_department, "_", thesis_language), ""))) +
  labs(title = "PhD theses lanuage before and after the year 2000",
       x = "Period",
       y = "Total number of PhD theses")


```

## Question 5

Create a scatter plot containing all theses that have a sustainability score ('sus_degree') bigger than 0. Please color the points by department ('thesis_department') and size them by their sustainability score ('sus_degree') (Tip: filter brfor plotting). What does the plot tell you?

```{r, include=FALSE}
phd_theses %>%
  filter(sus_degree > 0) %>%
  group_by(thesis_year, thesis_department) %>%
  summarise(sus_degree = sum(sus_degree)) %>%
  ggplot(aes(x = thesis_year, y = sus_degree, fill = thesis_department)) +
  geom_point(aes(color = thesis_department, size = sus_degree))
```

## Question 6

Please plot the relationship between thesis language and their gender score ('gen_degree'). Please interpret the plot.

```{r, include=FALSE}
phd_theses %>%
  mutate(thesis_year = factor(case_when(thesis_year < 1980 ~ "Pre-1980s",
                                 thesis_year < 1990 ~ "1980-1989",
                                 thesis_year < 2000 ~ "1990-1999",
                                 thesis_year < 2010 ~ "2000-2009",
                                 thesis_year > 2009 ~ "2010-Onwards"),
                              levels = c("Pre-1980s", "1980-1989", "1990-1999",
                                         "2000-2009", "2010-Onwards"))) %>%
  group_by(thesis_year, thesis_language) %>%
  summarise(sum = n(),
            gender = mean(gen_degree, na.rm = TRUE)) %>%
  mutate(gender = case_when(gender > 1 ~ "Takes gender serious",
                            gender > 0.5 ~ "Kind of takes gender serious",
                            .default = "Does not take gender serious")) %>%
  ggplot(aes(x = thesis_year, y = sum, fill = gender)) +
  geom_col() +
  facet_wrap('thesis_language', nrow = 3) +
  coord_flip() +
  labs(title = "Relationship between thesis language and their gender score",
       x = "Time period",
       y = "Total number of theses")
```
