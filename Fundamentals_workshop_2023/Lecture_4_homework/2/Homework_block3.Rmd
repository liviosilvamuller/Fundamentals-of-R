---
title: 'Visualizing Data'
subtitle: 'Fundamentals of R - Homework'
date: "2023"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

-   All materials for the exercises below are available on Moodle.

-   Please submit your answers as a HTML or a PDF file generated with Rmarkdown.

-   Please make sure to include code chunks and plots in submitted the document.

-   Please add titles, legends, and themes to your plots for clarity.

# Income of International Organizations

The 'io_income_rs.csv' dataset contains a non-random sample from funding data from some international organizations:

| Variables        | Description                                      |
|------------------|--------------------------------------------------|
| `year`           | Year of donation.                                |
| `donor`          | Donor (e.g. USA, Swirtzerland, IKEA Foundation). |
| `type_donor`     | Type of the donor (public or private).           |
| `amount_nominal` | Amount of donations in USD.                      |
| `issue_area`     | Issue area of recipient organization.            |

: The Financial Underpinnings of IOs

Please load the dataset and get acquainted with it. We will be working with it in this homework.

```{r include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(scales)
library(readr)
io_income_rs <- read_csv("io_income_rs.csv")
options(scipen = 999)
```

## Question 1

a-) Plot a histogram showing the distribution of donations per year.

```{r q1a, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
hist(io_income_rs$year)
```

b-) Plot various histogram showing the distribution of donations by public and private donors. What do we learn?

```{r q1b, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  drop_na(type_donor) %>%
  ggplot(aes(year)) +
  geom_histogram() +
  facet_wrap(~type_donor)
```

## Question 2

Has the amount that Switzerland donates to all issue areas increased over time? Please illustrate this relationship in a line plot, colored by the respective issue areas.

```{r q3, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  filter(donor== "Switzerland") %>%
  group_by(year, issue_area)%>%
  summarize(amount_nominal = sum(amount_nominal, na.rm = TRUE)) %>% 
  ggplot(mapping=aes(x=year, y=amount_nominal, color=issue_area))+
  geom_line() #minimal solution

io_income_rs %>%
  filter(donor== "Switzerland") %>%
  group_by(year, issue_area)%>%
  summarize(amount_nominal = sum(amount_nominal, na.rm = TRUE)) %>% 
  ggplot(mapping=aes(x=year, y=amount_nominal, color=issue_area))+
  geom_line(size=1)+
  scale_color_brewer(type="qual", palette= "Set2", direction=1)+
  scale_y_continuous(labels=scales::dollar_format(scale=.000001, suffix="m", prefix = "$"))+
    #dollar_format allows you to format the scale of dollars(thousands, millions, billions)
  labs( x = NULL, y = "Total donations to issue area", 
        title = "Donations by the Switzerland since 2000 by issue area", 
    subtitle=" composed by 4500 randomly sampled observations from dataset",
    caption = "Source: io_income_rs dataset")+
  theme(panel.background = element_rect("white", "black", .5, "solid"),
    panel.grid.major = element_line(color = "grey", size = 0.3, linetype = "solid"),
    axis.text = element_text(color = "black", size = 10),
    title = element_text(color = "black", size = 10, face = "bold"),
    legend.title = element_blank(),
    plot.subtitle = element_text(color = "black", size = 9, face = "plain"),
    legend.position = "none")+
    facet_wrap(~issue_area, scale="free_y")# let the y-scales of facets change.
```

## Question 3

Create a scatter plot containing all donations by year and issue area. Please add a smoothed line to show the direction of the relationship. The smoothed lines should be colored "red".

```{r q5, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  drop_na(type_donor) %>%
  ggplot(mapping=aes(x=year, y=amount_nominal)) +
  geom_point() +
  geom_smooth(method = "lm", color="red") +
  scale_y_log10(labels=scales::dollar) + #minimal
  facet_wrap(~issue_area)

io_income_rs %>%
  drop_na(type_donor) %>%
  ggplot(mapping=aes(x=year, y=amount_nominal)) +
  geom_point(position="jitter", 
# position jitter adds random noise to each observation, so they do not line up by year.
             alpha=.5) +  
  # alpha makes the points transparent.
  geom_smooth(method = "lm", color="red") +
  facet_wrap(~issue_area)+
  scale_y_log10(labels=scales::dollar) +
  labs(x = NULL, y = NULL, #removing redundant info from x and y axis
       title = "Donations to issues areay by year per type since 2000", 
       subtitle=" composed by 4500 randomly sampled observations from dataset",
       caption = "Source: io_income_rs dataset") +
  theme(panel.background = element_rect("white", "black", .5, "solid"),
    panel.grid.major = element_line(color = "grey", size = 0.3,
                                    linetype = "solid"),
    axis.text = element_text(color = "black", size = 10),
    title = element_text(color = "black", size = 10, face = "bold"),
    legend.title = element_blank(),
    plot.subtitle = element_text(color = "black", size = 9, face = "plain"),
    legend.position = "right")
```

## Question 4

Plot the distribution of all donations in the before the year 2010 (including the year 2010) and in after the year 2010 comparing public and private donors. Are there outliers for either of these types of donors before 2010? What about after 2010? (Tip: box plots are great for distributions! Please treat year as factor and scale the nominal amount using "scale_y_log10(labels = scales::dollar)").

```{r q4, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  drop_na(type_donor) %>%
  mutate(time = ifelse(year <= 2010, "pre-2010", "post-2010")) %>%
  ggplot(mapping=aes(x=as.factor(time), y=amount_nominal, fill=type_donor))+
  geom_boxplot()+
  scale_y_log10(labels=scales::dollar) #minimal solution

io_income_rs %>%
  drop_na(type_donor) %>%
  mutate(time = ifelse(year <= 2010, "pre-2010", "post-2010")) %>%
  ggplot(mapping=aes(x=as.factor(time), y=amount_nominal, fill=type_donor))+
  geom_boxplot()+
  scale_y_log10(labels=scales::dollar)+
  scale_fill_brewer(type="qual", palette= "Set2", direction=1)+
  labs( x = NULL, y = NULL, 
        title = "Distribution of donations by donor type pre and post 2010",
    subtitle=" composed by 4500 randomly sampled observations from dataset",
    caption = "Source: io_income_rs dataset")+
  theme(panel.background = element_rect("white", "black", .5, "solid"),
    panel.grid.major = element_line(color = "grey", size = 0.3, linetype = "solid"),
    axis.text = element_text(color = "black", size = 10),
    title = element_text(color = "black", size = 10, face = "bold"),
    legend.title = element_blank(),
    plot.subtitle = element_text(color = "black", size = 9, face = "plain"),
    legend.position = "right")
```

## Question 5

Create a bar plot displaying the top 10 overall donors and their total donations to all international organizations. Please color the donors by their type (i.e. public or private).

```{r q2, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  drop_na(donor) %>%
  group_by(donor, type_donor) %>%
  summarize(amount_nominal = sum(amount_nominal, na.rm = TRUE)) %>% 
  arrange(desc(amount_nominal)) %>%
  ungroup() %>%
  slice_head(n=10) %>% 
  ggplot(mapping=aes(x=donor, y= amount_nominal, fill=type_donor)) +
  geom_col() #minimal solution 

io_income_rs %>%
  drop_na(donor) %>%
  group_by(donor, type_donor) %>%
  summarize(amount_nominal = sum(amount_nominal, na.rm = TRUE)) %>% 
  arrange(desc(amount_nominal)) %>%
  ungroup() %>%
  slice_head(n=10) %>%
  ggplot(mapping=aes(x=reorder(donor, amount_nominal),
                     #order donors acc. to $$$
                     y= amount_nominal, fill=type_donor)) +
  geom_col()+
  scale_fill_brewer(type="qual", palette= "Accent", direction=1)+
  scale_y_continuous(labels=scales::dollar)+
  labs( x = NULL, y = "Total donations to IOs", title = "Top 10 donors from 2000 to 2020",
    subtitle=" composed by 4500 randomly sampled observations from dataset",
    caption = "Source: io_income_rs dataset")+
  theme(panel.background = element_rect("white", "black", .5, "solid"),
    panel.grid.major = element_line(color = "grey", size = 0.3, linetype = "solid"),
    axis.text = element_text(color = "black", size = 10),
    title = element_text(color = "black", size = 10, face = "bold"),
    legend.title = element_blank(),
    plot.subtitle = element_text(color = "black", size = 9, face = "plain"),
    legend.position = "bottom") +
    coord_flip() #flipping it to simplify reading
```

## Question 6

Please plot, however you choose, the relationship between amount donated, type of donor, and issue area. Please interpret the plot.

```{r q6, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
io_income_rs %>%
  drop_na(type_donor) %>%
  ggplot(mapping = aes(x = year, y = amount_nominal, fill = type_donor)) +
  geom_smooth(aes(color = type_donor), se = FALSE,
              method = "loess") +
  facet_wrap(~issue_area, scales = "free") +
  scale_y_log10(labels=scales::dollar) +
  labs(title = "Donations by type to different issues areas",
       caption = "Source: io_income_rs dataset") +
  theme_minimal()
```
